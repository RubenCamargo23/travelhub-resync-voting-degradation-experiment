<div class="dashboard-container">
    <div class="page-header">
        <h1 class="page-title">Experimento: Contraste de Tácticas</h1>
    </div>

    <!-- Services Health Grid -->
    <div class="services-grid">
        <app-service-card *ngFor="let service of services" [serviceName]="service.name" [status]="service.status"
            [description]="service.description" [detailedInfo]="service.detailedInfo || ''" [tags]="service.tags"
            [lastUpdated]="service.lastUpdated">
        </app-service-card>
    </div>

    <!-- H1 Contrast -->
    <div class="experiment-section">
        <div class="experiment-header">
            <h2>H1 — Resincronización (Outbox + Polling)</h2>
            <button (click)="testH1()" class="btn-run" [disabled]="h1Loading">
                {{ h1Loading ? 'Ejecutando...' : '▶ Ejecutar Contraste' }}
            </button>
        </div>
        <p class="experiment-desc">Si un microservicio cae y vuelve, ¿puede recuperar su consistencia?</p>

        <div class="contrast-grid" *ngIf="h1TacticsResult || h1NaiveResult">
            <div class="result-panel tactics">
                <div class="panel-header">
                    <span class="panel-badge tactics">✅ CON Tácticas</span>
                    <span class="panel-time" *ngIf="h1TacticsTime">{{ h1TacticsTime }}ms</span>
                </div>
                <p class="panel-label">Outbox + Event Polling</p>
                <pre class="result-json">{{ h1TacticsResult | json }}</pre>
            </div>
            <div class="result-panel naive">
                <div class="panel-header">
                    <span class="panel-badge naive">❌ SIN Tácticas</span>
                    <span class="panel-time" *ngIf="h1NaiveTime">{{ h1NaiveTime }}ms</span>
                </div>
                <p class="panel-label">Llamada directa, sin evento</p>
                <pre class="result-json">{{ h1NaiveResult | json }}</pre>
            </div>
        </div>
    </div>

    <!-- H2 Contrast -->
    <div class="experiment-section">
        <div class="experiment-header">
            <h2>H2 — Votación / Consenso (5 réplicas)</h2>
            <button (click)="testH2()" class="btn-run" [disabled]="h2Loading">
                {{ h2Loading ? 'Ejecutando...' : '▶ Ejecutar Contraste' }}
            </button>
        </div>
        <p class="experiment-desc">¿Puede un sistema de votación detectar una réplica defectuosa?</p>

        <div class="contrast-grid" *ngIf="h2TacticsResult || h2NaiveResult">
            <div class="result-panel tactics">
                <div class="panel-header">
                    <span class="panel-badge tactics">✅ CON Tácticas</span>
                    <span class="panel-time" *ngIf="h2TacticsTime">{{ h2TacticsTime }}ms</span>
                </div>
                <p class="panel-label">5 réplicas · Fan-Out · Votación mayoría</p>
                <pre class="result-json">{{ h2TacticsResult | json }}</pre>
            </div>
            <div class="result-panel naive">
                <div class="panel-header">
                    <span class="panel-badge naive">❌ SIN Tácticas</span>
                    <span class="panel-time" *ngIf="h2NaiveTime">{{ h2NaiveTime }}ms</span>
                </div>
                <p class="panel-label">Llamada única (replica_id=1)</p>
                <pre class="result-json">{{ h2NaiveResult | json }}</pre>
            </div>
        </div>
    </div>

    <!-- H3 Contrast -->
    <div class="experiment-section">
        <div class="experiment-header">
            <h2>H3 — Circuit Breaker / Degradación</h2>
            <button (click)="testH3()" class="btn-run" [disabled]="h3Loading">
                {{ h3Loading ? 'Ejecutando...' : '▶ Ejecutar Contraste' }}
            </button>
        </div>
        <p class="experiment-desc">¿Puede el Circuit Breaker degradar funcionalidad sin error 5xx al usuario?</p>

        <div class="contrast-grid" *ngIf="h3TacticsResult || h3NaiveResult">
            <div class="result-panel tactics">
                <div class="panel-header">
                    <span class="panel-badge tactics">✅ CON Tácticas</span>
                    <span class="panel-time" *ngIf="h3TacticsTime">{{ h3TacticsTime }}ms</span>
                </div>
                <p class="panel-label">Circuit Breaker + Fallback</p>
                <pre class="result-json">{{ h3TacticsResult | json }}</pre>
            </div>
            <div class="result-panel naive">
                <div class="panel-header">
                    <span class="panel-badge naive">❌ SIN Tácticas</span>
                    <span class="panel-time" *ngIf="h3NaiveTime">{{ h3NaiveTime }}ms</span>
                </div>
                <p class="panel-label">Llamada directa, sin protección</p>
                <pre class="result-json">{{ h3NaiveResult | json }}</pre>
            </div>
        </div>
    </div>
</div>